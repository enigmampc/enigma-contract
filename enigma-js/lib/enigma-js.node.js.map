{"version":3,"sources":["webpack://enigma-js/webpack/universalModuleDefinition","webpack://enigma-js/webpack/bootstrap","webpack://enigma-js/./src/Admin.js","webpack://enigma-js/./src/Enigma.js","webpack://enigma-js/./src/emitterConstants.js","webpack://enigma-js/./src/enigma-utils.js","webpack://enigma-js/./src/index.js","webpack://enigma-js/./src/models/Task.js","webpack://enigma-js/external \"axios\"","webpack://enigma-js/external \"buffer\"","webpack://enigma-js/external \"core-js/stable\"","webpack://enigma-js/external \"elliptic\"","webpack://enigma-js/external \"eth-crypto\"","webpack://enigma-js/external \"ethereumjs-abi\"","webpack://enigma-js/external \"eventemitter3\"","webpack://enigma-js/external \"jayson/lib/client/browser\"","webpack://enigma-js/external \"jsbi\"","webpack://enigma-js/external \"node-forge\"","webpack://enigma-js/external \"regenerator-runtime/runtime\"","webpack://enigma-js/external \"retry\"","webpack://enigma-js/external \"web3-utils\"","webpack://enigma-js/external \"zlib\""],"names":["Admin","web3","enigmaContract","tokenContract","txDefaults","enigma","sigAddr","methods","getWorkerFromSigningAddress","call","result","account","stakingAddress","status","parseInt","report","balance","logs","getWorker","worker","scAddr","getSecretContract","countSecretContracts","start","stop","getSecretContractAddresses","getAllSecretContractAddresses","codeHash","stateDeltaHashes","length","index","slice","stateDeltaHash","includes","emitter","EventEmitter","login","send","from","on","hash","emit","eeConstants","confirmationNumber","receipt","message","operatingAddress","setOperatingAddress","logout","amount","balanceOf","msg","name","approve","options","address","deposit","withdraw","signer","getOperatingAddressFromStakingAddress","Enigma","enigmaContractAddr","tokenContractAddr","rpcAddr","config","retry","retries","factor","minTimeout","maxTimeout","randomize","callServer","request","callback","headers","axios","post","JSON","parse","then","response","data","error","text","stringify","err","code","client","jaysonBrowserClient","workerParamsCache","selectedWorkerGroupCache","taskKeyLocalStorage","createContracts","admin","eth","Contract","EnigmaContract","EnigmaTokenContract","fn","args","gasLimit","gasPx","sender","scAddrOrPreCode","isContractDeploymentTask","getNonce","nonce","utils","generateScAddr","Buffer","isBuffer","preCode","gzip","preCodeGzip","Error","preCodeHash","soliditySha3","t","value","toString","argsTranspose","undefined","map","col","i","row","abiEncodedArgs","remove0x","abi","encodeParameters","abiEncodedArgsArray","n","push","substr","getBlockNumber","blockNumber","getWorkerParams","workerParams","firstBlockNumber","selectWorkerGroup","workerAddress","toLowerCase","obtainTaskKeyPair","publicKey","privateKey","Promise","resolve","reject","userPubKey","getWorkerEncryptionKeyResult","id","workerEncryptionKey","workerSig","hexToVerify","recAddress","EthCrypto","recover","console","derivedKey","getDerivedKey","encryptedFn","encryptMessage","encryptedAbiEncodedArgs","v","sign","userTaskSig","Task","task","increaseAllowance","createDeploymentTaskRecord","inputsHash","transactionHash","createTaskRecord","taskId","events","TaskRecordCreated","returnValues","ethStatus","creationBlockNumber","getTaskRecord","proof","taskRecord","outputHash","custodian","getReport","Object","keys","epochSize","getEpochSize","getWorkerParamsResult","seed","JSBI","BigInt","workers","stakes","x","params","workerGroupSize","tokenCpt","reduce","a","b","add","selectedWorkers","web3Utils","keccak256","randVal","remainder","selectedWorker","subtract","rpcEndpointName","emitName","serializeTask","operation","attempt","currentAttempt","getTaskResultResult","delta","ethereumPayload","ethereumAddress","encryptedAbiEncodedOutputs","output","usedGas","workerTaskSig","signature","engStatus","log","getTaskTimeoutSize","taskTimeoutSize","returnFeesForTask","decryptedOutput","decryptMessage","getTaskOutputHash","ethOutputHash","engOutputHash","getTaskRecordStatus","withResult","generator","p","next","d","innerPollTaskStatus","pollTaskStatusGen","interval","sleep","getTaskId","isBrowser","window","atob","localStorage","getItem","seedTask","random","forge","createInstance","seedFileSync","needed","util","fillString","bytesToHex","getBytes","publicKeyByPrivateKey","setItem","btoa","characters","charAt","Math","floor","trueNonce","getUserTaskDeployments","remoteNonce","localNonce","max","maxRetries","retryCount","createTask","scTask","sendTaskInput","encryptedArgs","userDHKey","contractAddress","ERROR","DEPOSIT_TRANSACTION_HASH","DEPOSIT_CONFIRMATION","DEPOSIT_RECEIPT","WITHDRAW_TRANSACTION_HASH","WITHDRAW_CONFIRMATION","WITHDRAW_RECEIPT","LOGIN_TRANSACTION_HASH","LOGIN_CONFIRMATION","LOGIN_RECEIPT","LOGOUT_TRANSACTION_HASH","LOGOUT_CONFIRMATION","LOGOUT_RECEIPT","SET_OPERATING_ADDRESS_TRANSACTION_HASH","SET_OPERATING_ADDRESS_CONFIRMATION","SET_OPERATING_ADDRESS_RECEIPT","DEPLOY_SC_ADDR_RESULT","DEPLOY_SC_ETH_TRANSACTION_HASH","DEPLOY_SC_ETH_CONFIRMATION","DEPLOY_SC_ETH_RECEIPT","DEPLOY_SC_ENG_RECEIPT","CREATE_TASK","CREATE_TASK_INPUT","CREATE_TASK_RECORD_TRANSACTION_HASH","CREATE_TASK_RECORD_CONFIRMATION","CREATE_TASK_RECORD_RECEIPT","CREATE_TASK_RECORD","SEND_TASK_INPUT_RESULT","POLL_TASK_STATUS_RESULT","GET_TASK_RESULT_RESULT","DEPLOY_SECRET_CONTRACT_RESULT","RETURN_FEES_FOR_TASK_RECEIPT","RETURN_FEES_FOR_TASK","POLL_TASK_ETH_RESULT","RPC_SEND_TASK_INPUT","RPC_DEPLOY_SECRET_CONTRACT","RPC_GET_TASK_RESULT","RPC_GET_TASK_STATUS","GET_TASK_RESULT_SUCCESS","GET_TASK_RESULT_FAILED","GET_TASK_RESULT_UNVERIFIED","GET_TASK_RESULT_INPROGRESS","ETH_STATUS_UNDEFINED","ETH_STATUS_CREATED","ETH_STATUS_VERIFIED","ETH_STATUS_FAILED","ETH_STATUS_FAILED_ETH","ETH_STATUS_FAILED_RETURN","usePureJavaScript","EC","elliptic","ec","appendMessages","hexStr","inputsArray","principal","principalPrefix","input","padStart","appendArrayMessages","array","principalHash","workerAddresses","workerStakes","commitReceiptsHash","inputsHashes","lastStateDeltaHash","outputHashes","gasesUsed","optionalEthereumData","optionalEthereumContractAddress","successFlag","enclavePublicKey","clientPrivateKey","clientKey","keyFromPrivate","enclaveKey","keyFromPublic","sharedPoints","getPublic","mul","getPrivate","y","getY","isOdd","getX","yBuffer","xBuffer","toArrayLike","sha256","md","create","update","digest","toHex","keyHex","msgHex","key","hexToBytes","msgBuf","iv","createBuffer","tag","decipher","cipher","createDecipher","finish","getBytesSync","createCipher","putBuffer","mode","putBytes","toGrains","engValue","hexString","substring","hexToAscii","replace","stack","isNaN","String","fromCharCode","join","ms","setTimeout","buffer","zlib","gunzip","test","msgId"],"mappings":"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AmB,GAAG,eAA5B;AACA,IAAMC,uBAAuB,GAAG,SAAhC;AACA,IAAMC,sBAAsB,GAAG,QAA/B;AACA,IAAMC,0BAA0B,GAAG,YAAnC;AACA,IAAMC,0BAA0B,GAAG,YAAnC;AAEA,IAAMC,oBAAoB,GAAG,CAA7B;AACA,IAAMC,kBAAkB,GAAG,CAA3B;AACA,IAAMC,mBAAmB,GAAG,CAA5B;AACA,IAAMC,iBAAiB,GAAG,CAA1B;AACA,IAAMC,qBAAqB,GAAG,CAA9B;AACA,IAAMC,wBAAwB,GAAG,CAAjC,C;;;;;;;;;;;;ACtDP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;CAEA;;AACA;AACA;AACA;AACA;AAEA3E,iDAAK,CAACvM,OAAN,CAAcmR,iBAAd,GAAkC,IAAlC;AAEA,IAAMC,EAAE,GAAGC,+CAAQ,CAACC,EAApB,C,CAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","file":"enigma-js.node.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"enigma-js\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"enigma-js\"] = factory();\n\telse\n\t\troot[\"enigma-js\"] = factory();\n})(global, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import EventEmitter from 'eventemitter3';\nimport * as eeConstants from './emitterConstants';\n\n/**\n * Encapsulates the admin operations\n */\nexport default class Admin {\n  /**\n   * Constructor\n   * @param {Web3} web3 - Web3 provider for the library\n   * @param {Web3.Contract} enigmaContract - Enigma contract deployed to Ethereum\n   * @param {Web3.Contract} tokenContract - Enigma token contract deployed to Ethereum\n   * @param {Object} txDefaults\n   * @param {Enigma} enigma - Enigma wrapper instance\n   */\n  constructor(web3, enigmaContract, tokenContract, txDefaults, enigma) {\n    this.web3 = web3;\n    this.enigmaContract = enigmaContract;\n    this.tokenContract = tokenContract;\n    this.txDefaults = txDefaults;\n    this.enigma = enigma;\n  }\n\n  /**\n   * Find worker by signing address\n   *\n   * @param {string} sigAddr - The signing address\n   * @return {Promise} Resolves to worker's details\n   */\n  async findBySigningAddress(sigAddr) {\n    const result = await this.enigmaContract.methods.getWorkerFromSigningAddress(sigAddr).call();\n    return {\n      account: result[0],\n      stakingAddress: result[1][0],\n      status: parseInt(result[1][2]),\n      report: result[1][3],\n      balance: parseInt(result[1][4]),\n      logs: result[1][5],\n    };\n  }\n\n  /**\n   * Get the worker's status\n   *\n   * @param {string} account - Worker's ETH address\n   * @return {Promise} Resolves to status of worker (0=Unregistered, 1=LoggedIn, 2=LoggedOut)\n   */\n  async getWorkerStatus(account) {\n    const worker = await this.enigmaContract.methods.getWorker(account).call();\n    return parseInt(worker.status);\n  }\n\n  /**\n   * Checks if a secret contract is deployed\n   *\n   * @param {string} scAddr - Secret contract address\n   * @return {Promise} Resolves to a boolean value whether the contract has been deployed or not\n   */\n  async isDeployed(scAddr) {\n    return parseInt((await this.enigmaContract.methods.getSecretContract(scAddr).call()).status) === 1;\n  }\n\n  /**\n   * Count the number of deployed secret contracts.\n   *\n   * @return {Promise} - Resolves to number of deployed secret contracts\n   */\n  async countSecretContracts() {\n    return parseInt(await this.enigmaContract.methods.countSecretContracts().call());\n  }\n\n  /**\n   * Get the addresses of deployed secret contracts within a specified range.\n   *\n   * @param {number} start - Start index of secret contract address to retrieve (inclusive)\n   * @param {number} stop - Stop index of secret contract address to retrieve (exclusive)\n   * @return {Promise} - Resolves to the addresses of deployed secret contracts within range\n   */\n  async getSecretContractAddresses(start, stop) {\n    return (await this.enigmaContract.methods.getSecretContractAddresses(start, stop).call());\n  }\n\n  /**\n   * Get the addresses of all deployed secret contracts.\n   *\n   * @return {Promise} - Resolves to the addresses of deployed secret contracts within range\n   */\n  async getAllSecretContractAddresses() {\n    return (await this.enigmaContract.methods.getAllSecretContractAddresses().call());\n  }\n\n  /**\n   * Fetches the secret contract bytecode hash\n   *\n   * @param {string} scAddr - Secret contract address\n   * @return {Promise} - Resolves to the bytecode hash of the deployed secret contract\n   */\n  async getCodeHash(scAddr) {\n    return (await this.enigmaContract.methods.getSecretContract(scAddr).call()).codeHash;\n  }\n\n  /**\n   * Count the state deltas for the specified secret contract.\n   *\n   * @param {string} scAddr - Secret contract address\n   * @return {Promise} - Resolves to count of state deltas\n   */\n  async countStateDeltas(scAddr) {\n    return (await this.enigmaContract.methods.getSecretContract(scAddr).call()).stateDeltaHashes.length;\n  }\n\n  /**\n   * Fetch the state delta hash at the specified index position\n   *\n   * @param {string} scAddr - Secret contract address\n   * @param {number} index - Index of state delta hash to retrieve\n   * @return {Promise} - Resolves to state delta hash at the specified position\n   */\n  async getStateDeltaHash(scAddr, index) {\n    return (await this.enigmaContract.methods.getSecretContract(scAddr).call()).stateDeltaHashes[index];\n  }\n\n  /**\n   * Fetch state delta hashes in the specified range\n   *\n   * @param {string} scAddr - Secret contract address\n   * @param {number} start - Start index of state delta hash to retrieve (inclusive)\n   * @param {number} stop - Stop index of state delta hash to retrieve (exclusive)\n   * @return {Promise} - Resolves to the state delta hashes in the specified range\n   */\n  async getStateDeltaHashes(scAddr, start, stop) {\n    return (await this.enigmaContract.methods.getSecretContract(scAddr).call()).stateDeltaHashes.slice(start, stop);\n  }\n\n  /**\n   * Check that the specified state delta hash is valid.\n   *\n   * @param {string} scAddr - Secret contract address\n   * @param {string} stateDeltaHash - State delta hash for a given task\n   * @return {Promise} Resolves to boolean value for whether the state delta hash is valid\n   */\n  async isValidDeltaHash(scAddr, stateDeltaHash) {\n    return (await this.enigmaContract.methods.getSecretContract(scAddr).call()).stateDeltaHashes.includes(\n        stateDeltaHash);\n  }\n\n  /**\n   * Login the selected worker\n   *\n   * @param {string} account - ETH address for worker being logged in\n   * @return {EventEmitter} EventEmitter to be listened to track login transaction\n   */\n  login(account) {\n    const emitter = new EventEmitter();\n    (async () => {\n      try {\n        await this.enigmaContract.methods.login().send({from: account}).on('transactionHash', (hash) => {\n          emitter.emit(eeConstants.LOGIN_TRANSACTION_HASH, hash);\n        }).on('confirmation', (confirmationNumber, receipt) => {\n          emitter.emit(eeConstants.LOGIN_CONFIRMATION, confirmationNumber, receipt);\n        }).on('receipt', (receipt) => {\n          emitter.emit(eeConstants.LOGIN_RECEIPT, receipt);\n        });\n      } catch (err) {\n        emitter.emit(eeConstants.ERROR, err.message);\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Set operating address for a staking address\n   *\n   * @param {string} stakingAddress - Staking address\n   * @param {string} operatingAddress - Operating address\n   * @return {EventEmitter} EventEmitter to be listened to track login transaction\n   */\n  setOperatingAddress(stakingAddress, operatingAddress) {\n    const emitter = new EventEmitter();\n    (async () => {\n      try {\n        await this.enigmaContract.methods.setOperatingAddress(operatingAddress).send({\n          from: stakingAddress,\n        }).on('transactionHash', (hash) => {\n          emitter.emit(eeConstants.SET_OPERATING_ADDRESS_TRANSACTION_HASH, hash);\n        }).on('confirmation', (confirmationNumber, receipt) => {\n          emitter.emit(eeConstants.SET_OPERATING_ADDRESS_CONFIRMATION, confirmationNumber, receipt);\n        }).on('receipt', (receipt) => {\n          emitter.emit(eeConstants.SET_OPERATING_ADDRESS_RECEIPT, receipt);\n        });\n      } catch (err) {\n        emitter.emit(eeConstants.ERROR, err.message);\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Logout the selected worker\n   *\n   * @param {string} account - ETH address for worker being logged out\n   * @return {EventEmitter} EventEmitter to be listened to track logout transaction\n   */\n  logout(account) {\n    const emitter = new EventEmitter();\n    (async () => {\n      try {\n        await this.enigmaContract.methods.logout().send({from: account}).on('transactionHash', (hash) => {\n          emitter.emit(eeConstants.LOGOUT_TRANSACTION_HASH, hash);\n        }).on('confirmation', (confirmationNumber, receipt) => {\n          emitter.emit(eeConstants.LOGOUT_CONFIRMATION, confirmationNumber, receipt);\n        }).on('receipt', (receipt) => {\n          emitter.emit(eeConstants.LOGOUT_RECEIPT, receipt);\n        });\n      } catch (err) {\n        emitter.emit(eeConstants.ERROR, err.message);\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Deposit ENG tokens in the worker's bank. Worker must be registered prior to this.\n   *\n   * @param {string} account - Worker's ETH address\n   * @param {number} amount - Number of ENG tokens to deposit, in grains (10**8 multiplier) format\n   * @return {EventEmitter} EventEmitter to be listened to track deposit transaction\n   */\n  deposit(account, amount) {\n    const emitter = new EventEmitter();\n    (async () => {\n      const balance = await this.tokenContract.methods.balanceOf(account).call();\n      if (balance < amount) {\n        const msg = 'Not enough tokens in wallet';\n        emitter.emit('error', {\n          name: 'NotEnoughTokens',\n          message: msg,\n        });\n        return;\n      }\n      await this.tokenContract.methods.approve(this.enigmaContract.options.address, amount).send({from: account});\n      try {\n        const receipt = await this.enigmaContract.methods.deposit(account, amount)\n            .send({from: account})\n            .on('transactionHash', (hash) => {\n              emitter.emit(eeConstants.DEPOSIT_TRANSACTION_HASH, hash);\n            })\n            .on('confirmation', (confirmationNumber, receipt) => {\n              emitter.emit(eeConstants.DEPOSIT_CONFIRMATION, confirmationNumber, receipt);\n            });\n        emitter.emit(eeConstants.DEPOSIT_RECEIPT, receipt);\n      } catch (err) {\n        emitter.emit(eeConstants.ERROR, err.message);\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Withdraw ENG tokens from the worker's bank. Worker must be in the logged out state and cannot withdraw in the\n   * same epoch as logging out.\n   *\n   * @param {string} account - Worker's ETH address\n   * @param {number} amount - Number of ENG tokens to deposit, in grains (10**8 multiplier) format\n   * @return {EventEmitter} EventEmitter to be listened to track deposit transaction\n   */\n  withdraw(account, amount) {\n    const emitter = new EventEmitter();\n    (async () => {\n      try {\n        await this.enigmaContract.methods.withdraw(amount).\n            send({from: account}).\n            on('transactionHash', (hash) => {\n              emitter.emit(eeConstants.WITHDRAW_TRANSACTION_HASH, hash);\n            }).\n            on('confirmation', (confirmationNumber, receipt) => {\n              emitter.emit(eeConstants.WITHDRAW_CONFIRMATION, confirmationNumber, receipt);\n            }).\n            on('receipt', (receipt) => {\n              emitter.emit(eeConstants.WITHDRAW_RECEIPT, receipt);\n            });\n      } catch (err) {\n        emitter.emit(eeConstants.ERROR, err.message);\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Get token balance for worker\n   *\n   * @param {string} account - Worker's ETH address\n   * @return {Promise} Resolves to ENG token balance in grains (10**8 multiplier) format\n   */\n  async getBalance(account) {\n    return parseInt((await this.enigmaContract.methods.getWorker(account).call()).balance);\n  }\n\n  /**\n   * Get worker's signer address\n   *\n   * @param {string} account - Worker's ETH address\n   * @return {Promise} Resolves to worker's signer address\n   */\n  async getWorkerSignerAddr(account) {\n    return (await this.enigmaContract.methods.getWorker(account).call()).signer;\n  }\n\n  /**\n   * Get worker's operating address from staking address\n   *\n   * @param {string} account - Worker's ETH address\n   * @return {Promise} Resolves to worker's signer address\n   */\n  async getOperatingAddressFromStakingAddress(account) {\n    return await this.enigmaContract.methods.getOperatingAddressFromStakingAddress(account).call();\n  }\n}\n","/* eslint-disable prefer-spread,prefer-rest-params,valid-jsdoc */\nimport EnigmaContract from '../../build/contracts/Enigma';\nimport EnigmaTokenContract from '../../build/contracts/EnigmaToken';\nimport Admin from './Admin';\nimport Task from './models/Task';\nimport EventEmitter from 'eventemitter3';\nimport web3Utils from 'web3-utils';\nimport jaysonBrowserClient from 'jayson/lib/client/browser';\nimport axios from 'axios';\nimport utils from './enigma-utils';\nimport forge from 'node-forge';\nimport JSBI from 'jsbi';\nimport retry from 'retry';\nimport * as abi from 'ethereumjs-abi';\nimport EthCrypto from 'eth-crypto';\nimport * as eeConstants from './emitterConstants';\n\n/**\n * Class encapsulation the Enigma operations.\n */\nexport default class Enigma {\n  /**\n   * The Enigma JS library constructor - a wrapper for Ethereum's Web3 library, offering additional services to\n   * leverage the Enigma protocol's unique features.\n   *\n   * @param {Web3} web3 - Web3 provider for the library\n   * @param {string} enigmaContractAddr - Address the Enigma contract is deployed to on Ethereum\n   * @param {string} tokenContractAddr - Address the Enigma token contract is deployed to on Ethereum\n   * @param {string} rpcAddr - Enigma p2p network address for RPC calls\n   * @param {Object} txDefaults\n   */\n  constructor(web3, enigmaContractAddr, tokenContractAddr, rpcAddr, txDefaults = {}, config = {}) {\n    this.web3 = web3;\n    this.txDefaults = txDefaults;\n\n    this.config = {};\n    this.config.retry = {};\n    this.config.retry.retries = config.retry ?\n      (config.retry.retries != null ? config.retry.retries : 5) : 5;\n    this.config.retry.factor = config.retry ?\n      (config.retry.factor != null ? config.retry.factor : 2) : 2;\n    this.config.retry.minTimeout = config.retry ?\n      (config.retry.minTimeout != null ? config.retry.minTimeout : 2000) : 2000;\n    this.config.retry.maxTimeout = config.retry ?\n      (config.retry.maxTimeout != null ? config.retry.maxTimeout : 'Infinity') : 'Infinity';\n    this.config.retry.randomize = config.retry ?\n      (config.retry.randomize != null ? config.retry.randomize : true) : true;\n\n    // axios callback for jayson rpc client to interface with ENG network\n    const callServer = function(request, callback) {\n      const config = {\n        headers: {\n          'Content-Type': 'application/json',\n          'credentials': 'include',\n        },\n      };\n      axios.post(rpcAddr, JSON.parse(request), config).then((response) => {\n        if (eeConstants.ERROR in response.data) {\n          callback(response.data.error, null);\n        } else {\n          const text = JSON.stringify(response.data.result);\n          callback(null, text);\n        }\n      }).catch(function(err) {\n        callback({code: -32000, message: err.message}, null);\n      });\n    };\n    this.client = jaysonBrowserClient(callServer, {});\n    this.workerParamsCache = {};\n    this.selectedWorkerGroupCache = {};\n    this.taskKeyLocalStorage = {};\n    this.createContracts(enigmaContractAddr, tokenContractAddr);\n  }\n\n  /**\n   * Initialize the worker-specific admin features\n   */\n  admin() {\n    this.admin = new Admin(this.web3, this.enigmaContract, this.tokenContract, this.txDefaults, this);\n  }\n\n  /**\n   * Initialize the Enigma and Enigma token contracts\n   *\n   * @param {string} enigmaContractAddr - Address the Enigma contract is deployed to on Ethereum\n   * @param {string} tokenContractAddr - Address the Enigma token contract is deployed to on Ethereum\n   */\n  createContracts(enigmaContractAddr, tokenContractAddr) {\n    this.enigmaContract = new this.web3.eth.Contract(EnigmaContract['abi'],\n        enigmaContractAddr, this.txDefaults);\n    this.tokenContract = new this.web3.eth.Contract(EnigmaTokenContract['abi'],\n        tokenContractAddr, this.txDefaults);\n  }\n\n  /**\n   * Create a base Task - a wrapper for a task (either contract deployments or compute tasks)\n   *\n   * @param {string} fn - Function name\n   * @param {Array} args - Inputs for task in the form of [[arg1, '<type>'], ..., [argn, '<type>']]\n   * @param {Number} gasLimit - ENG gas limit for task computation\n   * @param {Number} gasPx - ENG gas price for task computation\n   * @param {string} sender - ETH address for task sender\n   * @param {string/Buffer} scAddrOrPreCode - Either secret contract address (string) or precode (Buffer), depending\n   * on if user is running a contract deployment or compute task\n   * @param {boolean} isContractDeploymentTask - Is this task a contract deployment task (if not, it's a compute task)\n   * @returns {EventEmitter} EventEmitter to be listened to track creation of task. Emits a Task with base attributes\n   * to be used for remainder of task lifecycle\n   */\n  createTask(fn, args, gasLimit, gasPx, sender, scAddrOrPreCode, isContractDeploymentTask) {\n    const emitter = new EventEmitter();\n    (async () => {\n      // TODO: never larger that 53-bit?\n      const nonce = await this.getNonce(sender, isContractDeploymentTask);\n      const scAddr = isContractDeploymentTask ? utils.generateScAddr(sender, nonce) : scAddrOrPreCode;\n      let preCode;\n      let preCodeGzip;\n      if (isContractDeploymentTask) {\n        if (Buffer.isBuffer(scAddrOrPreCode)) {\n          preCode = scAddrOrPreCode;\n          // gzip the preCode\n          preCodeGzip = await utils.gzip(preCode);\n        } else {\n          throw Error('PreCode expected to be a Buffer, instead got '+typeof scAddrOrPreCode);\n        }\n      } else {\n        preCode = '';\n        preCodeGzip = '';\n      }\n\n      const preCodeHash = isContractDeploymentTask ?\n        this.web3.utils.soliditySha3({t: 'bytes', value: preCode.toString('hex')}) : '';\n      const argsTranspose = (args === undefined || args.length === 0) ? [[], []] :\n        args[0].map((col, i) => args.map((row) => row[i]));\n      const abiEncodedArgs = utils.remove0x(this.web3.eth.abi.encodeParameters(argsTranspose[1], argsTranspose[0]));\n      const abiEncodedArgsArray = [];\n      for (let n = 0; n < abiEncodedArgs.length; n += 2) {\n        abiEncodedArgsArray.push(parseInt(abiEncodedArgs.substr(n, 2), 16));\n      }\n      const blockNumber = await this.web3.eth.getBlockNumber();\n      const workerParams = await this.getWorkerParams(blockNumber);\n      const firstBlockNumber = workerParams.firstBlockNumber;\n      let workerAddress = await this.selectWorkerGroup(scAddr, workerParams, 1)[0]; // TODO: tmp fix 1 worker\n      workerAddress = workerAddress.toLowerCase().slice(-40); // remove leading '0x' if present\n      const {publicKey, privateKey} = this.obtainTaskKeyPair(sender, nonce);\n      try {\n        const getWorkerEncryptionKeyResult = await new Promise((resolve, reject) => {\n          this.client.request('getWorkerEncryptionKey',\n              {workerAddress: workerAddress, userPubKey: publicKey}, (err, response) => {\n                if (err) {\n                  reject(err);\n                  return;\n                }\n                resolve(response);\n              });\n        });\n        const {result, id} = getWorkerEncryptionKeyResult;\n        const {workerEncryptionKey, workerSig} = result;\n\n        // The signature of the workerEncryptionKey is generated\n        // concatenating the following elements in a bytearray:\n        // len('Enigma User Message') + b'Enigma User Message' + len(workerEncryptionKey) + workerEncryptionKey\n        // Because the first 3 elements are constant, they are hardcoded as follows:\n        // len('Enigma User Message') as a uint64 => 19 in hex => 0000000000000013\n        // bytes of 'Enigma User Message' in hex => 456e69676d612055736572204d657373616765\n        // len(workerEncryptionKey) as a unit64 => 64 in hex => 0000000000000040\n        const hexToVerify = '0x0000000000000013456e69676d612055736572204d6573736167650000000000000040' +\n          workerEncryptionKey;\n\n        // the hashing function soliditySha3 expects hex instead of bytes\n        let recAddress = EthCrypto.recover('0x'+workerSig,\n            this.web3.utils.soliditySha3({t: 'bytes', value: hexToVerify}));\n\n        recAddress = recAddress.toLowerCase().slice(-40); // remove leading '0x' if present\n\n        if (workerAddress !== recAddress) {\n          console.error('Worker address', workerAddress, '!= recovered address', recAddress);\n          emitter.emit(eeConstants.ERROR, {\n            name: 'InvalidWorker',\n            message: `Invalid worker encryption key + signature combo ${workerAddress} != ${recAddress}`,\n          });\n        } else {\n          // Generate derived key from worker's encryption key and user's private key\n          const derivedKey = utils.getDerivedKey(workerEncryptionKey, privateKey);\n          // Encrypt function and ABI-encoded args\n          const encryptedFn = utils.encryptMessage(derivedKey, fn);\n          const encryptedAbiEncodedArgs = utils.encryptMessage(derivedKey, Buffer.from(abiEncodedArgsArray));\n          const msg = this.web3.utils.soliditySha3(\n              {t: 'bytes', v: encryptedFn},\n              {t: 'bytes', v: encryptedAbiEncodedArgs},\n          );\n          const userTaskSig = await this.web3.eth.sign(msg, sender);\n          emitter.emit(eeConstants.CREATE_TASK, new Task(scAddr, encryptedFn, encryptedAbiEncodedArgs, gasLimit, gasPx,\n              id, publicKey, firstBlockNumber, workerAddress, workerEncryptionKey, sender, userTaskSig, nonce,\n              preCodeGzip.toString('base64'), preCodeHash, isContractDeploymentTask));\n        }\n      } catch (err) {\n        emitter.emit(eeConstants.ERROR, err);\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Create and store a task record on chain (ETH). Task records are necessary for collecting the ENG computation fee\n   * and computing the immutable taskId (a unique value for each task computed from hash(user's ETH address, user's\n   * nonce value monotonically increasing for every task deployment). Thus, task records have important implications for\n   * task ordering, fee payments, and verification.\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @returns {EventEmitter} EventEmitter to be listened to track creation of task record. Emits a Task with task\n   * record creation attributes to be used for remainder of task lifecycle\n   */\n  createTaskRecord(task) {\n    const emitter = new EventEmitter();\n    (async () => {\n      const balance = await this.tokenContract.methods.balanceOf(task.sender).call();\n      if (balance < (task.gasLimit * task.gasPx)) {\n        emitter.emit(eeConstants.ERROR, {\n          name: 'NotEnoughTokens',\n          message: 'Not enough tokens to pay the fee',\n        });\n        return;\n      }\n      await this.tokenContract.methods.increaseAllowance(this.enigmaContract.options.address,\n          task.gasLimit * task.gasPx).send({\n        from: task.sender,\n      });\n      try {\n        const receipt = task.isContractDeploymentTask ?\n          await this.enigmaContract.methods.createDeploymentTaskRecord(task.inputsHash, task.gasLimit,\n              task.gasPx, task.firstBlockNumber, task.nonce).send({\n            from: task.sender,\n          }).on('transactionHash', (hash) => {\n            task.transactionHash = hash;\n            emitter.emit(eeConstants.CREATE_TASK_RECORD_TRANSACTION_HASH, hash);\n          }).on('confirmation', (confirmationNumber, receipt) => {\n            emitter.emit(eeConstants.CREATE_TASK_RECORD_CONFIRMATION, confirmationNumber, receipt);\n          }) :\n          await this.enigmaContract.methods.createTaskRecord(task.inputsHash, task.gasLimit, task.gasPx,\n              task.firstBlockNumber).send({\n            from: task.sender,\n          }).on('transactionHash', (hash) => {\n            task.transactionHash = hash;\n            emitter.emit(eeConstants.CREATE_TASK_RECORD_TRANSACTION_HASH, hash);\n          }).on('confirmation', (confirmationNumber, receipt) => {\n            emitter.emit(eeConstants.CREATE_TASK_RECORD_CONFIRMATION, confirmationNumber, receipt);\n          });\n        task.taskId = receipt.events.TaskRecordCreated.returnValues.taskId;\n        task.receipt = receipt;\n        task.ethStatus = 1;\n        task.creationBlockNumber = receipt.blockNumber;\n        emitter.emit(eeConstants.CREATE_TASK_RECORD_RECEIPT, receipt);\n        emitter.emit(eeConstants.CREATE_TASK_RECORD, task);\n      } catch (err) {\n        emitter.emit(eeConstants.ERROR, err.message);\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Get the Task's task record status from Ethereum\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @return {Promise} Resolves to Task wrapper with updated ethStatus and proof properties\n   */\n  async getTaskRecordStatus(task) {\n    const result = await this.enigmaContract.methods.getTaskRecord(task.taskId).call();\n    task.ethStatus = parseInt(result.status);\n    task.proof = result.proof;\n    return task;\n  }\n\n  /**\n   * Get the Task's task record status from Ethereum\n   *\n   * @param {string} taskId - Task ID\n   * @return {Promise} Resolves to TaskRecord struct\n   */\n  async getTaskRecordFromTaskId(taskId) {\n    const taskRecord = await this.enigmaContract.methods.getTaskRecord(taskId).call();\n    return {\n      sender: taskRecord.sender,\n      inputsHash: taskRecord.inputsHash,\n      outputHash: taskRecord.outputHash,\n      gasLimit: parseInt(taskRecord.gasLimit),\n      gasPx: parseInt(taskRecord.gasPx),\n      blockNumber: parseInt(taskRecord.blockNumber),\n      status: parseInt(taskRecord.status),\n      proof: taskRecord.proof,\n    };\n  }\n\n  /**\n   * Fetch output hash for a given task\n   *\n   * @param {Task} task - Task wrapper\n   * @return {Promise} - Resolves to output hash for the task\n   */\n  async getTaskOutputHash(task) {\n    return (await this.enigmaContract.methods.getTaskRecord(task.taskId).call()).outputHash;\n  }\n\n  /**\n   * Find SGX report\n   *\n   * @param {string} custodian - Worker's address\n   * @return {Promise} Resolves to SGX report for the worker\n   */\n  async getReport(custodian) {\n    return await this.enigmaContract.methods.getReport(custodian).call();\n  }\n\n  /**\n   * Given a block number, obtain the worker parameters. These parameters remain the same for a given secret\n   * contract and epoch (fixed number of blocks). These parameters are cached until the epoch changes.\n   *\n   * @param {int} blockNumber - Block number of task record's mining\n   * @return {Promise} Resolves to the worker params, which includes a seed (random int generated from the principal\n   * node), first block number for the epoch, list of active work addresses (ordered list of worker signing addresses\n   * that were logged in at the start of the epoch), and list of active worker balances\n   */\n  async getWorkerParams(blockNumber) {\n    if ((Object.keys(this.workerParamsCache).length === 0) ||\n      (blockNumber - this.workerParamsCache.firstBlockNumber >= this.epochSize)) {\n      this.epochSize = await this.enigmaContract.methods.getEpochSize().call();\n      const getWorkerParamsResult = await this.enigmaContract.methods.getWorkerParams(blockNumber).call();\n      this.workerParamsCache = {\n        firstBlockNumber: parseInt(getWorkerParamsResult[0]),\n        seed: JSBI.BigInt(getWorkerParamsResult[1]),\n        workers: getWorkerParamsResult[2],\n        stakes: getWorkerParamsResult[3].map((x) => JSBI.BigInt(x)),\n      };\n    }\n    return this.workerParamsCache;\n  }\n\n  /**\n   * Select the workers weighted-randomly based on the staked token amount that will run the computation task\n   *\n   * @param {string} scAddr - Secret contract address\n   * @param {Object} params - Worker params (epoch first block number, seed, worker signing addresses, worker stakes)\n   * @param {number} workerGroupSize - Number of workers to be selected for task\n   * @return {Array} An array of selected workers where each selected worker is chosen with probability equal to\n   * number of staked tokens\n   */\n  selectWorkerGroup(scAddr, params, workerGroupSize = 5) {\n    // Find total number of staked tokens for workers\n    const tokenCpt = params.stakes.reduce((a, b) => JSBI.add(a, b), JSBI.BigInt(0));\n    let nonce = 0;\n    const selectedWorkers = [];\n    do {\n      // Unique hash for epoch, secret contract address, and nonce\n      const msg = abi.rawEncode(\n          ['uint256', 'bytes32', 'uint256'],\n          [params.seed.toString(10), scAddr, nonce],\n      );\n      const hash = web3Utils.keccak256(msg);\n      // Find random number between [0, tokenCpt)\n      let randVal = JSBI.remainder(JSBI.BigInt(hash), tokenCpt);\n      let selectedWorker = params.workers[params.workers.length - 1];\n      // Loop through each worker, subtracting worker's balance from the random number computed above. Once the\n      // decrementing randVal becomes negative, add the worker whose balance caused this to the list of selected\n      // workers. If worker has already been selected, increase nonce by one, resulting in a new hash computed above.\n      for (let i = 0; i < params.workers.length; i++) {\n        randVal = JSBI.subtract(randVal, params.stakes[i]);\n        if (randVal <= 0) {\n          selectedWorker = params.workers[i];\n          break;\n        }\n      }\n      if (!selectedWorkers.includes(selectedWorker)) {\n        selectedWorkers.push(selectedWorker);\n      }\n      nonce++;\n    }\n    while (selectedWorkers.length < workerGroupSize);\n    return selectedWorkers;\n  }\n\n  /**\n   * Send Task to Enigma p2p network for computation\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @return {EventEmitter} EventEmitter to be listened to track submission of Task to Enigma p2p network. Emits\n   * a response from the ENG network indicating whether client is ready to track the remainder of the task lifecycle\n   */\n  sendTaskInput(task) {\n    const emitter = new EventEmitter();\n    (async () => {\n      let rpcEndpointName = eeConstants.RPC_SEND_TASK_INPUT;\n      let emitName = eeConstants.SEND_TASK_INPUT_RESULT;\n      if (task.isContractDeploymentTask) {\n        rpcEndpointName = eeConstants.RPC_DEPLOY_SECRET_CONTRACT;\n        emitName = eeConstants.DEPLOY_SECRET_CONTRACT_RESULT;\n      }\n      try {\n        await new Promise((resolve, reject) => {\n          this.client.request(rpcEndpointName, Enigma.serializeTask(task), (err, response) => {\n            if (err) {\n              reject(err);\n              return;\n            }\n            resolve(response);\n          });\n        });\n        emitter.emit(emitName, task);\n      } catch (err) {\n        emitter.emit(eeConstants.ERROR, err);\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Get task result from p2p network\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @return {EventEmitter} EventEmitter to be listened to track getting result from Enigma network. Emits\n   * a response from the ENG network.\n   */\n  getTaskResult(task) {\n    const emitter = new EventEmitter();\n\n    const operation = retry.operation(this.config.retry);\n    operation.attempt(async (currentAttempt)=>{\n      try {\n        const getTaskResultResult = await new Promise((resolve, reject) => {\n          this.client.request(eeConstants.RPC_GET_TASK_RESULT,\n              {taskId: utils.remove0x(task.taskId)}, (err, response) => {\n                if (err) {\n                  reject(err);\n                  return;\n                }\n                resolve(response);\n              });\n        });\n        if (getTaskResultResult.result) {\n          switch (getTaskResultResult.result.status) {\n            case eeConstants.GET_TASK_RESULT_SUCCESS:\n              task.delta = getTaskResultResult.result.delta;\n              task.ethereumPayload = getTaskResultResult.result.ethereumPayload;\n              task.ethereumAddress = getTaskResultResult.result.ethereumAddress;\n              task.preCodeHash = getTaskResultResult.result.preCodeHash;\n            case eeConstants.GET_TASK_RESULT_FAILED:\n              task.encryptedAbiEncodedOutputs = getTaskResultResult.result.output;\n              task.usedGas = getTaskResultResult.result.usedGas;\n              task.workerTaskSig = getTaskResultResult.result.signature;\n            case eeConstants.GET_TASK_RESULT_UNVERIFIED:\n            case eeConstants.GET_TASK_RESULT_INPROGRESS:\n              task.engStatus = getTaskResultResult.result.status;\n              break;\n            default:\n              throw (new Error('Invalid task result status')).message;\n          }\n        } else {\n          if (operation.retry(true)) {\n            console.log('Warning: Got an empty TaskResult on attempt '+\n              currentAttempt+' of '+(this.config.retry.retries + 1)+'. Retrying...');\n            return;\n          } else {\n            task.engStatus = null;\n          }\n        }\n        emitter.emit(eeConstants.GET_TASK_RESULT_RESULT, task);\n      } catch (err) {\n        emitter.emit(eeConstants.ERROR, err);\n      }\n    });\n\n    return emitter;\n  }\n\n  /**\n   * Return fees for task\n   *\n   * @param {Task} task - Task wrapper\n   * @returns {EventEmitter} EventEmitter to be listened to track return of fees\n   */\n  returnFeesForTask(task) {\n    const emitter = new EventEmitter();\n    (async () => {\n      const taskTimeoutSize = await this.enigmaContract.methods.getTaskTimeoutSize().call();\n      const blockNumber = await this.web3.eth.getBlockNumber();\n      if (blockNumber - task.creationBlockNumber <= taskTimeoutSize) {\n        emitter.emit(eeConstants.ERROR, {\n          name: 'InvalidTaskReturn',\n          message: 'Not enough time has elapsed to return task funds',\n        });\n        return;\n      }\n      try {\n        const receipt = await this.enigmaContract.methods.returnFeesForTask(task.taskId).send({\n          from: task.sender,\n        });\n        task.ethStatus = eeConstants.ETH_STATUS_FAILED_RETURN;\n        emitter.emit(eeConstants.RETURN_FEES_FOR_TASK_RECEIPT, receipt);\n        emitter.emit(eeConstants.RETURN_FEES_FOR_TASK, task);\n      } catch (err) {\n        emitter.emit(eeConstants.ERROR, err.message);\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Decrypt task result\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @return {Task} Task result wrapper with an updated decrypted output attribute\n   */\n  async decryptTaskResult(task) {\n    console.log('task.encryptedAbiEncodedOutputs is '+task.encryptedAbiEncodedOutputs);\n    if (task.encryptedAbiEncodedOutputs) {\n      const {privateKey} = this.obtainTaskKeyPair(task.sender, task.nonce);\n      const derivedKey = utils.getDerivedKey(task.workerEncryptionKey, privateKey);\n      task.decryptedOutput = utils.decryptMessage(derivedKey, task.encryptedAbiEncodedOutputs);\n    } else {\n      console.log('Warning: task.encryptedAbiEncodedOutputs is empty, there is nothing to decrypt.');\n      task.decryptedOutput = null;\n    }\n    return task;\n  }\n\n  /**\n   * Verify ENG network output matches output registered on ETH\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @return {boolean} True/false on whether outputs match\n   */\n  async verifyTaskOutput(task) {\n    const ethOutputHash = await this.getTaskOutputHash(task);\n    const engOutputHash = this.web3.utils.soliditySha3(\n        {t: 'bytes', value: task.encryptedAbiEncodedOutputs.toString('hex')}\n    );\n    return ethOutputHash === engOutputHash;\n  }\n\n  /**\n   * Verify ENG network status matches status registered on ETH\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @return {boolean} True/false on whether statuses match\n   */\n  async verifyTaskStatus(task) {\n    const ethStatus = (await this.getTaskRecordStatus(task)).ethStatus;\n    switch (task.engStatus) {\n      case eeConstants.GET_TASK_RESULT_SUCCESS:\n        return ethStatus === eeConstants.ETH_STATUS_VERIFIED;\n        break;\n      case eeConstants.GET_TASK_RESULT_FAILED:\n        return ethStatus === eeConstants.ETH_STATUS_FAILED;\n        break;\n      case eeConstants.GET_TASK_RESULT_UNVERIFIED:\n      case eeConstants.GET_TASK_RESULT_INPROGRESS:\n        return ethStatus === eeConstants.ETH_STATUS_CREATED;\n        break;\n      default:\n        return ethStatus === eeConstants.ETH_STATUS_UNDEFINED;\n    }\n  }\n\n  /**\n   * Generator function for polling the Enigma p2p network for task status\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @param {boolean} withResult - Task wrapper for contract deployment and compute tasks\n   */\n  * pollTaskStatusGen(task, withResult) {\n    while (true) {\n      yield new Promise((resolve, reject) => {\n        this.client.request(eeConstants.RPC_GET_TASK_STATUS, {\n          taskId: utils.remove0x(task.taskId), workerAddress: task.workerAddress,\n          withResult: withResult,\n        }, (err, response) => {\n          if (err) {\n            reject(err);\n            return;\n          }\n          task.engStatus = response.result.status;\n          if (withResult) {\n            task.encryptedAbiEncodedOutputs = response.result.output;\n          }\n          resolve(task);\n        });\n      });\n    }\n  }\n\n  /**\n   * Inner poll status function that continues to poll the Enigma p2p network until the task has been verified\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @param {pollTaskStatusGen} generator - Generator function for polling Enigma p2p network for task status\n   * @param {EventEmitter} emitter - EventEmitter to track Enigma p2p network polling for Task status\n   */\n  innerPollTaskStatus(task, generator, emitter) {\n    const p = generator.next();\n    p.value.then((d) => {\n      emitter.emit(eeConstants.POLL_TASK_STATUS_RESULT, d);\n      if (d.engStatus !== 'SUCCESS' && d.engStatus !== 'FAILED') {\n        this.innerPollTaskStatus(task, generator, emitter);\n      }\n    }).catch((err) => {\n      emitter.emit(eeConstants.ERROR, err);\n    });\n  }\n\n  /**\n   * Poll the Enigma p2p network for a TaskInput's status\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @param {boolean} withResult - Task wrapper for contract deployment and compute tasks\n   * @return {EventEmitter} EventEmitter to be listened to track polling the Enigma p2p network for a Task status.\n   * Emits a Task with task result attributes\n   */\n  pollTaskStatus(task, withResult = false) {\n    const emitter = new EventEmitter();\n    const generator = this.pollTaskStatusGen(task, withResult);\n    this.innerPollTaskStatus(task, generator, emitter);\n    return emitter;\n  }\n\n  /**\n   * Poll the ETH for a Task's status\n   *\n   * @param {Task} task - Task wrapper for contract deployment and compute tasks\n   * @param {Number} interval - Polling interval in ms\n   * @return {Task} Task wrapper with updated ETH status.\n   */\n  async pollTaskETH(task, interval=1000) {\n    while (task.ethStatus === eeConstants.ETH_STATUS_CREATED) {\n      task = await this.getTaskRecordStatus(task);\n      await utils.sleep(interval);\n    }\n    return task;\n  }\n\n  /**\n   * Serialize Task for submission to the Enigma p2p network depending on whether it is a deployment or compute task\n   *\n   * @param {Task} task - Task wrapper for contract deployment or compute task\n   * @return {Object} Serialized Task for submission to the Enigma p2p network\n   */\n  static serializeTask(task) {\n    return task.isContractDeploymentTask ? {\n      preCode: task.preCode,\n      encryptedArgs: utils.remove0x(task.encryptedAbiEncodedArgs), encryptedFn: utils.remove0x(task.encryptedFn),\n      userDHKey: utils.remove0x(task.userPubKey), contractAddress: utils.remove0x(task.scAddr),\n      workerAddress: task.workerAddress,\n    } : {\n      taskId: utils.remove0x(task.taskId), workerAddress: task.workerAddress,\n      encryptedFn: utils.remove0x(task.encryptedFn), encryptedArgs: utils.remove0x(task.encryptedAbiEncodedArgs),\n      contractAddress: utils.remove0x(task.scAddr), userDHKey: utils.remove0x(task.userPubKey),\n    };\n  }\n\n  /**\n   * Obtain task key pair that has been set\n   *\n   * @return {Object} Public key-private key pair\n   */\n  obtainTaskKeyPair(sender, nonce) {\n    // TODO: Developer tool to allow users to select their own unique passphrase to generate private key\n    const taskId = this.getTaskId(sender, nonce);\n\n    const isBrowser = typeof window !== 'undefined';\n    let privateKey;\n    const seed = isBrowser ? atob(window.localStorage.getItem('seed')) :\n      this.taskKeyLocalStorage['seed'];\n\n    if (seed == null) {\n      throw Error('Need to set seed through setTaskKeyPair first');\n    } else {\n      const seedTask = seed + taskId;\n      const random = forge.random.createInstance();\n      random.seedFileSync = function(needed) {\n        return forge.util.fillString(seedTask, needed);\n      };\n      privateKey = forge.util.bytesToHex(random.getBytes(32));\n    }\n\n    const publicKey = EthCrypto.publicKeyByPrivateKey(privateKey);\n\n    isBrowser ? window.localStorage.setItem('encodedPrivateKey'+taskId, btoa(privateKey)) :\n      this.taskKeyLocalStorage['encodedPrivateKey'+taskId] = Buffer.from(privateKey, 'binary').toString('base64');\n\n    return {publicKey, privateKey};\n  }\n\n  /**\n   * Deterministically generate a key-secret pair necessary for deriving a shared encryption key with the selected\n   * worker. This pair will be stored in local storage for quick retrieval.\n   *\n   * @param {string} seed - Optional seed\n   * @return {string} Seed\n   */\n  setTaskKeyPair(seed='') {\n    const isBrowser = typeof window !== 'undefined';\n    if (seed === '') {\n      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n      for (let i = 0; i < 9; i++) {\n        seed += characters.charAt(Math.floor(Math.random() * characters.length));\n      }\n    }\n    // TODO: Query user for passphrase\n\n    // const random = forge.random.createInstance();\n    // random.seedFileSync = function(needed) {\n    //   return forge.util.fillString(seed, needed);\n    // };\n    // const privateKey = forge.util.bytesToHex(random.getBytes(32));\n    // isBrowser ? window.localStorage.setItem('encodedPrivateKey', btoa(privateKey)) :\n    //   this.taskKeyLocalStorage['encodedPrivateKey'] = Buffer.from(privateKey, 'binary').toString('base64');\n    isBrowser ? window.localStorage.setItem('seed', btoa(seed)) :\n      this.taskKeyLocalStorage['seed'] = seed;\n    return seed;\n  }\n\n  /**\n   * Return the nonce for the current task, the maximum of the nonce returned by the contract and the\n   * one we are tracking locally to avoid conflicts in concurrency.\n   *\n   * @param {string} sender - ETH address for task sender\n   * @param {boolean} trueNonce - if this is a contract deployment use a true nonce from the contract\n   * @return {Number} nonce\n   */\n  async getNonce(sender, trueNonce = false) {\n    const isBrowser = typeof window !== 'undefined';\n    const remoteNonce = parseInt(await this.enigmaContract.methods.getUserTaskDeployments(sender).call());\n    let nonce;\n    if (trueNonce) {\n      nonce = remoteNonce;\n    } else {\n      const localNonce = isBrowser ? parseInt(window.localStorage.getItem('nonce-'+sender)) :\n      parseInt(this.taskKeyLocalStorage['nonce-'+sender]);\n      // If localNonce undefined, return remoteNonce, otherwise Math.max() returns NaN\n      nonce = localNonce ? Math.max(remoteNonce, localNonce) : remoteNonce;\n    }\n    // Store the next nonce we will use, to match what the query from the contract will return\n    isBrowser ? window.localStorage.setItem('nonce-'+sender, nonce+1) :\n      this.taskKeyLocalStorage['nonce-'+sender] = nonce+1;\n    return nonce;\n  }\n\n  /**\n   * Create a task to deploy a secret contract - creates base task, creates task record, and sends task to the\n   * Enigma network. This is the most efficient and likely most common method for creating and deploying a secret\n   * contract.\n   *\n   * @param {string} fn - Function name\n   * @param {Array} args - Inputs for task in the form of [[arg1, '<type>'], ..., [argn, '<type>']]\n   * @param {Number} gasLimit - ENG gas limit for task computation\n   * @param {Number} gasPx - ENG gas price for task computation\n   * @param {string} sender - ETH address for task sender\n   * @param {string} preCode - Precode for contract deployment\n   * @param {Number} maxRetries - Max number of retries if submitted around epoch change\n   * @return {Task} Task with attributes necessary for task record and Enigma network\n   */\n  deploySecretContract(fn, args, gasLimit, gasPx, sender, preCode, maxRetries=1) {\n    const emitter = new EventEmitter();\n    (async () => {\n      let retryCount = 0;\n      while (true) {\n        try {\n          let scTask = await new Promise((resolve, reject) => {\n            this.createTask(fn, args, gasLimit, gasPx, sender, preCode, true).\n                on(eeConstants.CREATE_TASK, (result) => resolve(result)).\n                on(eeConstants.ERROR, (error) => reject(error));\n          });\n          emitter.emit(eeConstants.CREATE_TASK, scTask);\n          scTask = await new Promise((resolve, reject) => {\n            this.createTaskRecord(scTask).\n                on(eeConstants.CREATE_TASK_RECORD, (result) => resolve(result)).\n                on(eeConstants.ERROR, (error) => reject(error));\n          });\n          emitter.emit(eeConstants.CREATE_TASK_RECORD, scTask);\n          await new Promise((resolve, reject) => {\n            this.sendTaskInput(scTask).\n                on(eeConstants.DEPLOY_SECRET_CONTRACT_RESULT, (receipt) => resolve(receipt)).\n                on(eeConstants.ERROR, (error) => reject(error));\n          });\n          emitter.emit(eeConstants.DEPLOY_SECRET_CONTRACT_RESULT, scTask);\n          break;\n        } catch (err) {\n          if ((retryCount++ >= maxRetries) ||\n            ((err !== 'Returned error: VM Exception while processing transaction: revert Wrong epoch for this task') &&\n            (err !== 'Returned error: VM Exception while processing transaction:'+\n              ' revert Incorrect nonce yielding bad secret contract address'))) {\n            emitter.emit(eeConstants.ERROR, err);\n            break;\n          }\n        }\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Create a compute task - creates base task, creates task record, and sends task to the Enigma network. This is the\n   * most efficient and likely most common method for creating and sending a compute task.\n   *\n   * @param {string} fn - Function name\n   * @param {Array} args - Inputs for task in the form of [[arg1, '<type>'], ..., [argn, '<type>']]\n   * @param {Number} gasLimit - ENG gas limit for task computation\n   * @param {Number} gasPx - ENG gas price for task computation\n   * @param {string} sender - ETH address for task sender\n   * @param {string} scAddr - Secret contract address\n   * @param {Number} maxRetries - Max number of retries if submitted around epoch change\n   * @return {Task} Task with attributes necessary for task record and Enigma network\n   */\n  computeTask(fn, args, gasLimit, gasPx, sender, scAddr, maxRetries=1) {\n    const emitter = new EventEmitter();\n    (async () => {\n      let retryCount = 0;\n      while (true) {\n        try {\n          let task = await new Promise((resolve, reject) => {\n            this.createTask(fn, args, gasLimit, gasPx, sender, scAddr, false).\n                on(eeConstants.CREATE_TASK, (result) => resolve(result)).\n                on(eeConstants.ERROR, (error) => reject(error));\n          });\n          emitter.emit(eeConstants.CREATE_TASK, task);\n          task = await new Promise((resolve, reject) => {\n            this.createTaskRecord(task).\n                on(eeConstants.CREATE_TASK_RECORD, (result) => resolve(result)).\n                on(eeConstants.ERROR, (error) => reject(error));\n          });\n          emitter.emit(eeConstants.CREATE_TASK_RECORD, task);\n          await new Promise((resolve, reject) => {\n            this.sendTaskInput(task).\n                on(eeConstants.SEND_TASK_INPUT_RESULT, (receipt) => resolve(receipt)).\n                on(eeConstants.ERROR, (error) => reject(error));\n          });\n          emitter.emit(eeConstants.SEND_TASK_INPUT_RESULT, task);\n          break;\n        } catch (err) {\n          if ((retryCount++ >= maxRetries) ||\n            (err !== 'Returned error: VM Exception while processing transaction: revert Wrong epoch for this task')) {\n            emitter.emit(eeConstants.ERROR, err);\n            break;\n          }\n        }\n      }\n    })();\n    return emitter;\n  }\n\n  /**\n   * Return the taskId given a sender and a nonce, using the same algorithm used in the contract\n   *\n   * @param {string} sender - Ethereum address\n   * @param {Number} nonce\n   * @return {string} taskId\n   */\n  getTaskId(sender, nonce) {\n    return this.web3.utils.soliditySha3({t: 'address', v: sender}, {t: 'uint256', v: nonce});\n  }\n\n  /**\n   * Return the version number of the library\n   *\n   * @return {string}\n   */\n  static version() {\n    return '0.0.1';\n  }\n}\n","export const ERROR = 'error';\nexport const DEPOSIT_TRANSACTION_HASH = 'depositTransactionHash';\nexport const DEPOSIT_CONFIRMATION = 'depositConfirmation';\nexport const DEPOSIT_RECEIPT = 'depositReceipt';\nexport const WITHDRAW_TRANSACTION_HASH = 'withdrawTransactionHash';\nexport const WITHDRAW_CONFIRMATION = 'withdrawConfirmation';\nexport const WITHDRAW_RECEIPT = 'withdrawReceipt';\nexport const LOGIN_TRANSACTION_HASH = 'loginTransactionHash';\nexport const LOGIN_CONFIRMATION = 'loginConfirmation';\nexport const LOGIN_RECEIPT = 'loginReceipt';\nexport const LOGOUT_TRANSACTION_HASH = 'logoutTransactionHash';\nexport const LOGOUT_CONFIRMATION = 'logoutConfirmation';\nexport const LOGOUT_RECEIPT = 'logoutReceipt';\nexport const SET_OPERATING_ADDRESS_TRANSACTION_HASH = 'setOperatingAddressTransactionHash';\nexport const SET_OPERATING_ADDRESS_CONFIRMATION = 'setOperatingAddressConfirmation';\nexport const SET_OPERATING_ADDRESS_RECEIPT = 'setOperatingAddressReceipt';\n\nexport const DEPLOY_SC_ADDR_RESULT = 'deploySCAddrResult';\nexport const DEPLOY_SC_ETH_TRANSACTION_HASH = 'deploySCEthTransactionHash';\nexport const DEPLOY_SC_ETH_CONFIRMATION = 'deploySCEthConfirmation';\nexport const DEPLOY_SC_ETH_RECEIPT = 'deploySCEthReceipt';\nexport const DEPLOY_SC_ENG_RECEIPT = 'deploySCEngReceipt';\n\nexport const CREATE_TASK = 'createTask';\nexport const CREATE_TASK_INPUT = 'createTaskInput';\nexport const CREATE_TASK_RECORD_TRANSACTION_HASH = 'createTaskRecordTransactionHash';\nexport const CREATE_TASK_RECORD_CONFIRMATION = 'createTaskRecordConfirmation';\nexport const CREATE_TASK_RECORD_RECEIPT = 'createTaskRecordReceipt';\nexport const CREATE_TASK_RECORD = 'createTaskRecord';\n\nexport const SEND_TASK_INPUT_RESULT = 'sendTaskInputResult';\nexport const POLL_TASK_STATUS_RESULT = 'pollTaskStatusResult';\nexport const GET_TASK_RESULT_RESULT = 'getTaskResultResult';\nexport const DEPLOY_SECRET_CONTRACT_RESULT = 'deploySecretContractResult';\n\nexport const RETURN_FEES_FOR_TASK_RECEIPT = 'returnFeesForTaskReceipt';\nexport const RETURN_FEES_FOR_TASK = 'returnFeesForTask';\n\nexport const POLL_TASK_ETH_RESULT = 'pollTaskETHResult';\n\nexport const RPC_SEND_TASK_INPUT = 'sendTaskInput';\nexport const RPC_DEPLOY_SECRET_CONTRACT = 'deploySecretContract';\nexport const RPC_GET_TASK_RESULT = 'getTaskResult';\nexport const RPC_GET_TASK_STATUS = 'getTaskStatus';\nexport const GET_TASK_RESULT_SUCCESS = 'SUCCESS';\nexport const GET_TASK_RESULT_FAILED = 'FAILED';\nexport const GET_TASK_RESULT_UNVERIFIED = 'UNVERIFIED';\nexport const GET_TASK_RESULT_INPROGRESS = 'INPROGRESS';\n\nexport const ETH_STATUS_UNDEFINED = 0;\nexport const ETH_STATUS_CREATED = 1;\nexport const ETH_STATUS_VERIFIED = 2;\nexport const ETH_STATUS_FAILED = 3;\nexport const ETH_STATUS_FAILED_ETH = 4;\nexport const ETH_STATUS_FAILED_RETURN = 5;\n","import JSBI from 'jsbi';\nimport web3Utils from 'web3-utils';\n// import RLP from 'rlp';\nimport forge from 'node-forge';\nimport elliptic from 'elliptic';\nimport {Buffer} from 'buffer';\nimport zlib from 'zlib';\n\nforge.options.usePureJavaScript = true;\n\nconst EC = elliptic.ec;\n\n// const pki = forge.pki;\n\n// const INTEL_CA = '-----BEGIN CERTIFICATE-----\\n' +\n//   'MIIFSzCCA7OgAwIBAgIJANEHdl0yo7CUMA0GCSqGSIb3DQEBCwUAMH4xCzAJBgNV\\n' +\n//   'BAYTAlVTMQswCQYDVQQIDAJDQTEUMBIGA1UEBwwLU2FudGEgQ2xhcmExGjAYBgNV\\n' +\n//   'BAoMEUludGVsIENvcnBvcmF0aW9uMTAwLgYDVQQDDCdJbnRlbCBTR1ggQXR0ZXN0\\n' +\n//   'YXRpb24gUmVwb3J0IFNpZ25pbmcgQ0EwIBcNMTYxMTE0MTUzNzMxWhgPMjA0OTEy\\n' +\n//   'MzEyMzU5NTlaMH4xCzAJBgNVBAYTAlVTMQswCQYDVQQIDAJDQTEUMBIGA1UEBwwL\\n' +\n//   'U2FudGEgQ2xhcmExGjAYBgNVBAoMEUludGVsIENvcnBvcmF0aW9uMTAwLgYDVQQD\\n' +\n//   'DCdJbnRlbCBTR1ggQXR0ZXN0YXRpb24gUmVwb3J0IFNpZ25pbmcgQ0EwggGiMA0G\\n' +\n//   'CSqGSIb3DQEBAQUAA4IBjwAwggGKAoIBgQCfPGR+tXc8u1EtJzLA10Feu1Wg+p7e\\n' +\n//   'LmSRmeaCHbkQ1TF3Nwl3RmpqXkeGzNLd69QUnWovYyVSndEMyYc3sHecGgfinEeh\\n' +\n//   'rgBJSEdsSJ9FpaFdesjsxqzGRa20PYdnnfWcCTvFoulpbFR4VBuXnnVLVzkUvlXT\\n' +\n//   'L/TAnd8nIZk0zZkFJ7P5LtePvykkar7LcSQO85wtcQe0R1Raf/sQ6wYKaKmFgCGe\\n' +\n//   'NpEJUmg4ktal4qgIAxk+QHUxQE42sxViN5mqglB0QJdUot/o9a/V/mMeH8KvOAiQ\\n' +\n//   'byinkNndn+Bgk5sSV5DFgF0DffVqmVMblt5p3jPtImzBIH0QQrXJq39AT8cRwP5H\\n' +\n//   'afuVeLHcDsRp6hol4P+ZFIhu8mmbI1u0hH3W/0C2BuYXB5PC+5izFFh/nP0lc2Lf\\n' +\n//   '6rELO9LZdnOhpL1ExFOq9H/B8tPQ84T3Sgb4nAifDabNt/zu6MmCGo5U8lwEFtGM\\n' +\n//   'RoOaX4AS+909x00lYnmtwsDVWv9vBiJCXRsCAwEAAaOByTCBxjBgBgNVHR8EWTBX\\n' +\n//   'MFWgU6BRhk9odHRwOi8vdHJ1c3RlZHNlcnZpY2VzLmludGVsLmNvbS9jb250ZW50\\n' +\n//   'L0NSTC9TR1gvQXR0ZXN0YXRpb25SZXBvcnRTaWduaW5nQ0EuY3JsMB0GA1UdDgQW\\n' +\n//   'BBR4Q3t2pn680K9+QjfrNXw7hwFRPDAfBgNVHSMEGDAWgBR4Q3t2pn680K9+Qjfr\\n' +\n//   'NXw7hwFRPDAOBgNVHQ8BAf8EBAMCAQYwEgYDVR0TAQH/BAgwBgEB/wIBADANBgkq\\n' +\n//   'hkiG9w0BAQsFAAOCAYEAeF8tYMXICvQqeXYQITkV2oLJsp6J4JAqJabHWxYJHGir\\n' +\n//   'IEqucRiJSSx+HjIJEUVaj8E0QjEud6Y5lNmXlcjqRXaCPOqK0eGRz6hi+ripMtPZ\\n' +\n//   'sFNaBwLQVV905SDjAzDzNIDnrcnXyB4gcDFCvwDFKKgLRjOB/WAqgscDUoGq5ZVi\\n' +\n//   'zLUzTqiQPmULAQaB9c6Oti6snEFJiCQ67JLyW/E83/frzCmO5Ru6WjU4tmsmy8Ra\\n' +\n//   'Ud4APK0wZTGtfPXU7w+IBdG5Ez0kE1qzxGQaL4gINJ1zMyleDnbuS8UicjJijvqA\\n' +\n//   '152Sq049ESDz+1rRGc2NVEqh1KaGXmtXvqxXcTB+Ljy5Bw2ke0v8iGngFBPqCTVB\\n' +\n//   '3op5KBG3RjbF6RRSzwzuWfL7QErNC8WEy5yDVARzTA5+xmBc388v9Dm21HGfcC8O\\n' +\n//   'DD+gT9sSpssq0ascmvH49MOgjt1yoysLtdCtJW/9FZpoOypaHx0R+mJTLwPXVMrv\\n' +\n//   'DaVzWh5aiEx+idkSGMnX\\n' +\n//   '-----END CERTIFICATE-----';\n\n// /**\n//  * Serialize the pem cert.\n//  *\n//  * @param {string} pem\n//  * @return {*}\n//  */\n// function readCert(pem) {\n//   let cert;\n//\n//   try {\n//     cert = pki.certificateFromPem(pem);\n//   } catch (e) {\n//     return {\n//       verified: false,\n//       err: 'Failed to load report certificate : ' + e,\n//     };\n//   }\n//   return cert;\n// }\n\n// /**\n//  * Parse the signer's address from the quote\n//  *\n//  * @param {string} reportContent\n//  * @return {string}\n//  */\n// function parseAddress(reportContent) {\n//   const report = JSON.parse(reportContent);\n//   let b = new Buffer(report.isvEnclaveQuoteBody, 'base64');\n//\n//   return b.slice(368, 410).toString();\n// }\n\n// /**\n//  * Verifies that the worker signer address is associated to an authentic SGX report\n//  *\n//  * @param {string} signer\n//  * @param {string} encodedReport\n//  * @return {*}\n//  */\n// function verifyWorker(signer, encodedReport) {\n//   const reportArgs = RLP.decode(encodedReport);\n//   // console.log ('decoding report\\n', reportArgs[0], '\\n', reportArgs[1], '\\n', reportArgs[2]);\n//   const report = reportArgs[0].toString('utf8');\n//\n//   if (report === 'simulation') {\n//     return {\n//       verified: true,\n//       err: 'Running in simulation mode',\n//     };\n//   }\n//\n//   const reportCert = reportArgs[1].toString('utf8');\n//   const reportSig = reportArgs[2];\n//   const cert = readCert(reportCert);\n//   let md = forge.md.sha256.create();\n//\n//   md.update(report, 'utf8');\n//\n//   try {\n//     // verify data with a public key\n//     // (defaults to RSASSA PKCS#1 v1.5)\n//     // TODO: verify that the public key belongs to the signer\n//     const verified = cert.publicKey.verify(md.digest().bytes(), reportSig);\n//\n//     if (!verified) {\n//       return {\n//         verified: false,\n//         err: 'The signature does not match the signed report',\n//       };\n//     }\n//   } catch (e) {\n//     return {\n//       verified: false,\n//       err: 'Failed to verify the report signature: ' + e,\n//     };\n//   }\n//\n//   let caStore;\n//\n//   try {\n//     caStore = pki.createCaStore([INTEL_CA]);\n//   } catch (e) {\n//     return {\n//       verified: false,\n//       err: 'Failed to load CA certificate: ' + e,\n//     };\n//   }\n//\n//   try {\n//     pki.verifyCertificateChain(caStore, [cert]);\n//   } catch (e) {\n//     return {\n//       verified: false,\n//       err: 'Failed to verify certificate: ' + e,\n//     };\n//   }\n//\n//   const address = parseAddress(report);\n//\n//   if (address !== signer) {\n//     return {\n//       verified: false,\n//       err: 'Signer address does not match the report: ' + signer + ' != ' +\n//         address,\n//     };\n//   }\n//\n//   return {verified: true, err: undefined};\n// }\n\n// /**\n//  * Encode secret contract function arguments\n//  *\n//  * @param {Object} args\n//  * @return {string}\n//  */\n// function encodeArguments(args) {\n//   return '0x' + RLP.encode(args).toString('hex');\n// }\n\n/**\n * Generate a taskId using a hash of all inputs\n * The Enigma contract uses the same logic to generate a matching taskId\n *\n * @param {string} sender\n * @param {Number} nonce\n * @return {string}\n */\nfunction generateScAddr(sender, nonce) {\n  return web3Utils.soliditySha3(\n      {t: 'bytes', v: sender},\n      {t: 'uint', v: nonce},\n  );\n}\n\n/**\n * Generate a taskId using a hash of all inputs\n * The Enigma contract uses the same logic to generate a matching taskId\n *\n * @param {string} hexStr - Buffer being appended to\n * @param {Array} inputsArray - Array of inputs\n * @param {boolean} principal - Principal hashing\n * @return {string} - Final appended hex string\n */\nfunction appendMessages(hexStr, inputsArray, principal=false) {\n  const principalPrefix = principal ? '00' : '';\n  for (let input of inputsArray) {\n    input = remove0x(input);\n    // since the inputs are in hex string, they are twice as long as their bytes\n    hexStr += principalPrefix + JSBI.BigInt(input.length/2).toString(16).padStart(16, '0') + input;\n  }\n  return hexStr;\n}\n\n/**\n * Generate a hash of an array containing an array of inputs\n *\n * @param {string} hexStr - Buffer being appended to\n * @param {Array} inputsArray - Array of array of inputs\n * @param {boolean} principal - Principal hashing\n * @return {string} - Final appended hex string\n */\nfunction appendArrayMessages(hexStr, inputsArray) {\n  const principalPrefix = '01';\n  for (const array of inputsArray) {\n    hexStr += principalPrefix + JSBI.BigInt(array[0].length * (array[1]+9)).toString(16).padStart(16, '0');\n    hexStr = appendMessages(hexStr, array[0], true);\n  }\n  return hexStr;\n}\n\n/**\n * Generate a hash of all inputs\n *\n * @param {array} inputsArray - Array of inputs\n * @return {string} Hash of inputs\n */\nfunction hash(inputsArray) {\n  const hexStr = appendMessages('', inputsArray);\n  return web3Utils.soliditySha3({t: 'bytes', v: hexStr});\n}\n\n/**\n * Generate a hash of inputs for setting the worker params from the principal node\n *\n * @param {Number} seed - The random integer generated by the enclave\n * @param {Number} nonce - Nonce value for principal node\n * @param {Array} workerAddresses - Worker signing addresses\n * @param {Array} workerStakes - Worker stake balances\n * @return {string} Hash of inputs\n */\nfunction principalHash(seed, nonce, workerAddresses, workerStakes) {\n  let hexStr = '';\n  hexStr = appendMessages(hexStr, [seed, nonce], true);\n  hexStr = appendArrayMessages(hexStr, [[workerAddresses, 20], [workerStakes, 32]]);\n  return web3Utils.soliditySha3({t: 'bytes', v: hexStr});\n}\n\n/**\n * Generate a hash of inputs necessary for commit multiple receipts logic\n *\n * @param {string} codeHash\n * @param {Array} inputsHashes\n * @param {string} lastStateDeltaHash\n * @param {Array} stateDeltaHashes\n * @param {Array} outputHashes\n * @param {Array} gasesUsed\n * @param {string} optionalEthereumData\n * @param {string} optionalEthereumContractAddress\n * @param {string} successFlag\n * @return {string} hash of inputs\n */\nfunction commitReceiptsHash(codeHash, inputsHashes, lastStateDeltaHash, stateDeltaHashes, outputHashes, gasesUsed,\n    optionalEthereumData, optionalEthereumContractAddress, successFlag) {\n  let hexStr = '';\n  hexStr = appendMessages(hexStr, [codeHash]);\n  hexStr = appendArrayMessages(hexStr, [inputsHashes]);\n  hexStr = appendMessages(hexStr, [lastStateDeltaHash]);\n  hexStr = appendArrayMessages(hexStr, [stateDeltaHashes, outputHashes, gasesUsed]);\n  hexStr = appendMessages(hexStr, [optionalEthereumData, optionalEthereumContractAddress, successFlag]);\n\n  return web3Utils.soliditySha3({t: 'bytes', v: hexStr});\n}\n\n// /**\n//  * RLP encode report parts\n//  *\n//  * @param {string} report\n//  * @param {string} cert\n//  * @param {string} sig\n//  * @return {string}\n//  */\n// function encodeReport(report, cert, sig) {\n//   return '0x' + RLP.encode([report, cert, sig]).toString('hex');\n// }\n\n// /**\n//  * Verifies that the specified method signature matches the specs defined\n//  * by the Ethereum abi: https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI\n//  *\n//  * @param {string} methodSig\n//  * @return {boolean}\n//  */\n// function checkMethodSignature(methodSig) {\n//   const rx = /\\b\\((.*?)\\)/g;\n//   const result = rx.test(methodSig);\n//\n//   return result;\n// }\n\n// /**\n//  * Generate an Ethereum-like address from a public key\n//  *\n//  * @param {string} publicKey\n//  * @return {string}\n//  */\n// function toAddress(publicKey) {\n//   const address = EthCrypto.publicKey.toAddress(publicKey);\n//\n//   return address;\n// }\n\n// /**\n//  * Sign a message with the specified private key\n//  *\n//  * @param {string} privateKey\n//  * @param {string} message\n//  * @return {string}\n//  */\n// function sign(privateKey, message) {\n//   return EthCrypto.sign(\n//     privateKey,\n//     message,\n//   );\n// }\n\n// /**\n//  * Returns the address with which the message was signed\n//  *\n//  * @param {string} signature\n//  * @param {string} message\n//  * @return {string}\n//  */\n// function recover(signature, message) {\n//   return EthCrypto.recover(\n//     signature,\n//     message,\n//   );\n// }\n\n// /**\n//  * Returns the public key associated with the message signature\n//  *\n//  * @param {string} signature\n//  * @param {string} message\n//  * @return {string} Public key\n//  */\n// function recoverPublicKey(signature, message) {\n//   return EthCrypto.recoverPublicKey(\n//     signature,\n//     message,\n//   );\n// }\n\n/**\n * This does ECDH key derivation from 2 EC secp256k1 keys.\n * It does so by multiplying the public points by the private point of the over key.\n * This results in a X and Y. it then replaces the Y with 0x02 if Y is even and 0x03 if it's odd.\n * Then it hashes the new Y together with the X using SHA256.\n * Multiplication: https://github.com/indutny/elliptic/blob/master/lib/elliptic/ec/key.js#L104\n * Replacing Y: https://source.that.world/source/libsecp256k1-rs/browse/master/src/ecdh.rs$25\n *\n * @param {string} enclavePublicKey\n * @param {string} clientPrivateKey\n * @return {string}\n */\nfunction getDerivedKey(enclavePublicKey, clientPrivateKey) {\n  const ec = new EC('secp256k1');\n\n  if (enclavePublicKey.length == 128) {\n    enclavePublicKey = '04' + enclavePublicKey;\n  }\n\n  const clientKey = ec.keyFromPrivate(clientPrivateKey, 'hex');\n  const enclaveKey = ec.keyFromPublic(enclavePublicKey, 'hex');\n\n  const sharedPoints = enclaveKey.getPublic().mul(clientKey.getPrivate());\n  const y = 0x02 | (sharedPoints.getY().isOdd() ? 1 : 0);\n  const x = sharedPoints.getX();\n  const yBuffer = Buffer.from([y]);\n  const xBuffer = x.toArrayLike(Buffer, 'be', 32);\n\n  const sha256 = forge.md.sha256.create();\n\n  sha256.update(yBuffer.toString('binary'));\n  sha256.update(xBuffer.toString('binary'));\n\n  return sha256.digest().toHex();\n}\n\n/**\n * Decrypts the encrypted message:\n * Message format: encrypted_message[*]tag[16]iv[12] (represented as: var_name[len])\n *\n * @param {string} keyHex - Derived key\n * @param {string} msgHex - Encrypted message\n * @return {string} Decrypted message\n */\nfunction decryptMessage(keyHex, msgHex) {\n  const key = forge.util.hexToBytes(keyHex);\n  const msgBuf = Buffer.from(msgHex, 'hex');\n  const iv = forge.util.createBuffer(msgBuf.slice(-12));\n  const tag = forge.util.createBuffer(msgBuf.slice(-28, -12));\n  const decipher = forge.cipher.createDecipher('AES-GCM', key);\n\n  decipher.start({iv: iv, tag: tag});\n  decipher.update(\n      forge.util.createBuffer(msgBuf.slice(0, -28)));\n\n  if (decipher.finish()) {\n    return decipher.output.toHex();\n  }\n  throw new Error('decipher did not finish');\n}\n\n/**\n * Encrypts a message using the provided key.\n * Returns an encrypted message in this format:\n * encrypted_message[*]tag[16]iv[12] (represented as: var_name[len])\n *\n * @param {string} keyHex - Derived key\n * @param {string} msg - Unencrypted message\n * @param {string} iv\n * @return {string} Encrypted message\n */\nfunction encryptMessage(keyHex, msg, iv = forge.random.getBytesSync(12)) {\n  const key = forge.util.hexToBytes(keyHex);\n  const cipher = forge.cipher.createCipher('AES-GCM', key);\n\n  cipher.start({iv: iv});\n  cipher.update(forge.util.createBuffer(msg));\n  cipher.finish();\n\n  const result = cipher.output.putBuffer(cipher.mode.tag).putBytes(iv);\n\n  return result.toHex();\n}\n\n/**\n * Converts ENG value to grains format.\n *\n * @param {int} engValue\n * @return {int} ENG value in grains format\n */\nfunction toGrains(engValue) {\n  return engValue * 10**8;\n}\n\n// /**\n//  * Converts grains format to ENG value.\n//  *\n//  * @param {int} grains\n//  * @return {int}\n//  */\n// function fromGrains(grains) {\n//   return grains / 10**8;\n// }\n\n/**\n * Removes '0x' from a hex string, if present\n *\n * @param {string} hexString\n * @return {string}\n */\nfunction remove0x(hexString) {\n  if (hexString.substring(0, 2) == '0x') {\n    return hexString.substring(2);\n  } else {\n    return hexString;\n  }\n}\n\n/**\n * Converts a hex string to its ASCII representation\n *\n * @param {string} hexString\n * @return {string}\n */\nfunction hexToAscii(hexString) {\n  if (!(typeof hexString === 'number' || typeof hexString == 'string')) {\n    return '';\n  }\n  hexString = hexString.toString().replace(/\\s+/gi, '');\n  const stack = [];\n  for (let n = 0; n < hexString.length; n += 2) {\n    const code = parseInt(hexString.substr(n, 2), 16);\n    if (!isNaN(code) && code !== 0) {\n      stack.push(String.fromCharCode(code));\n    }\n  }\n  return stack.join('');\n}\n\n/**\n * Sleeps\n *\n * @param {int} ms\n * @return {undefined}\n */\nfunction sleep(ms) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\n/** Compress using GZIP\n *  @param {Buffer} buffer to compress\n *  @return {Promise}\n * */\nfunction gzip(buffer) {\n  return new Promise((resolve, reject)=> {\n    zlib.gzip(buffer, (error, result)=>{\n      if (error) {\n        reject(error);\n      } else {\n        resolve(result);\n      }\n    });\n  });\n}\n\n/** Unzip using GZIP\n *  @param {Buffer} buffer compressed\n *  @return {Promise}\n * */\nfunction gunzip(buffer) {\n  return new Promise((resolve, reject) => {\n    zlib.gunzip(buffer, (error, result) => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(result);\n      }\n    });\n  });\n}\n\n\nconst utils = {};\n\n// utils.readCert = readCert;\n// utils.encodeReport = encodeReport;\nutils.test = () => 'hello2';\n// utils.encodeArguments = encodeArguments;\nutils.generateScAddr = generateScAddr;\nutils.hash = hash;\nutils.principalHash = principalHash;\nutils.commitReceiptsHash = commitReceiptsHash;\n// utils.verifyWorker = verifyWorker;\n// utils.checkMethodSignature = checkMethodSignature;\n// utils.toAddress = toAddress;\n// utils.sign = sign;\n// utils.recover = recover;\n// utils.recoverPublicKey = recoverPublicKey;\nutils.getDerivedKey = getDerivedKey;\nutils.encryptMessage = encryptMessage;\nutils.decryptMessage = decryptMessage;\nutils.toGrains = toGrains;\n// utils.fromGrains = fromGrains;\nutils.remove0x = remove0x;\nutils.hexToAscii = hexToAscii;\nutils.sleep = sleep;\nutils.gzip = gzip;\nutils.gunzip = gunzip;\n\nexport default utils;\n","import 'core-js/stable';\nimport 'regenerator-runtime/runtime';\n// window.Promise = Promise;\nimport utils from './enigma-utils';\nimport Enigma from './Enigma';\nimport * as eeConstants from './emitterConstants';\nimport Task from './models/Task';\n\nexport {Enigma, utils, eeConstants, Task};\n","import utils from '../enigma-utils';\n\n/**\n * Encapsulates the Task\n */\nexport default class Task {\n  /**\n   * Task wrapper for contract deployment and regular tasks. This object is iteratively built up during the task\n   * lifecycle\n   *\n   * @param {string} scAddr\n   * @param {string} encryptedFn\n   * @param {string} encryptedAbiEncodedArgs\n   * @param {Number} gasLimit\n   * @param {Number} gasPx\n   * @param {string} msgId\n   * @param {string} userPubKey\n   * @param {Number} firstBlockNumber\n   * @param {string} workerAddress\n   * @param {string} workerEncryptionKey\n   * @param {string} sender\n   * @param {string} userTaskSig\n   * @param {Number} nonce\n   * @param {string} preCode\n   * @param {string} preCodeHash\n   * @param {boolean} isContractDeploymentTask\n   */\n  constructor(scAddr, encryptedFn, encryptedAbiEncodedArgs, gasLimit, gasPx, msgId, userPubKey, firstBlockNumber,\n      workerAddress, workerEncryptionKey, sender, userTaskSig, nonce, preCode, preCodeHash,\n      isContractDeploymentTask) {\n    // Initial task attributes\n    this.inputsHash = utils.hash([encryptedFn, encryptedAbiEncodedArgs,\n      isContractDeploymentTask ? preCodeHash : scAddr, userPubKey]);\n    this.scAddr = scAddr;\n    this.encryptedFn = encryptedFn;\n    this.encryptedAbiEncodedArgs = encryptedAbiEncodedArgs;\n    this.gasLimit = gasLimit;\n    this.gasPx = gasPx;\n    this.msgId = msgId;\n    this.userPubKey = userPubKey;\n    this.firstBlockNumber = firstBlockNumber;\n    this.workerAddress = workerAddress;\n    this.workerEncryptionKey = workerEncryptionKey;\n    this.sender = sender;\n    this.userTaskSig = userTaskSig;\n    this.nonce = nonce;\n    this.preCode = preCode;\n    this.preCodeHash = preCodeHash;\n    this.isContractDeploymentTask = isContractDeploymentTask;\n\n    // Attributes added to task when task record is created on ETH, most critically, the taskId (a unique value\n    // for each task computed from hash(hash(encrypted function signature, encrypted ABI-encoded arguments, gas limit,\n    // gas price, user's ETH address), user's nonce value monotonically increasing for every task deployment)\n    this.transactionHash = '';\n    this.taskId = '';\n    this.receipt = '';\n    this.ethStatus = 0;\n    this.proof = '';\n    this.creationBlockNumber = -1;\n\n    // Attributes added to task when computation result is being polled/retrieved from the ENG network\n    this.encryptedAbiEncodedOutputs = '';\n    this.delta = '';\n    this.usedGas = '';\n    this.ethereumPayload = '';\n    this.ethereumAddress = '';\n    this.workerTaskSig = '';\n    this.engStatus = 'null';\n\n    this.decryptedOutput = '';\n  }\n}\n","module.exports = require(\"axios\");","module.exports = require(\"buffer\");","module.exports = require(\"core-js/stable\");","module.exports = require(\"elliptic\");","module.exports = require(\"eth-crypto\");","module.exports = require(\"ethereumjs-abi\");","module.exports = require(\"eventemitter3\");","module.exports = require(\"jayson/lib/client/browser\");","module.exports = require(\"jsbi\");","module.exports = require(\"node-forge\");","module.exports = require(\"regenerator-runtime/runtime\");","module.exports = require(\"retry\");","module.exports = require(\"web3-utils\");","module.exports = require(\"zlib\");"],"sourceRoot":""}